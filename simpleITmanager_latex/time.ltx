\documentclass[10pt,a4paper,english]{article}
\usepackage{babel}
\usepackage{ae}
\usepackage{aeguill}
\usepackage{shortvrb}
\usepackage[latin1]{inputenc}
\usepackage{tabularx}
\usepackage{longtable}
\setlength{\extrarowheight}{2pt}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{color}
\usepackage{multirow}
\usepackage{ifthen}
\usepackage[DIV12]{typearea}
% generated by Docutils <http://docutils.sourceforge.net/>
\newlength{\admonitionwidth}
\setlength{\admonitionwidth}{0.9\textwidth}
\newlength{\docinfowidth}
\setlength{\docinfowidth}{0.9\textwidth}
\newlength{\locallinewidth}
\newcommand{\optionlistlabel}[1]{\bf #1 \hfill}
\newenvironment{optionlist}[1]
{\begin{list}{}
  {\setlength{\labelwidth}{#1}
   \setlength{\rightmargin}{1cm}
   \setlength{\leftmargin}{\rightmargin}
   \addtolength{\leftmargin}{\labelwidth}
   \addtolength{\leftmargin}{\labelsep}
   \renewcommand{\makelabel}{\optionlistlabel}}
}{\end{list}}
\newlength{\lineblockindentation}
\setlength{\lineblockindentation}{2.5em}
\newenvironment{lineblock}[1]
{\begin{list}{}
  {\setlength{\partopsep}{\parskip}
   \addtolength{\partopsep}{\baselineskip}
   \topsep0pt\itemsep0.15\baselineskip\parsep0pt
   \leftmargin#1}
 \raggedright}
{\end{list}}
% begin: floats for footnotes tweaking.
\setlength{\floatsep}{0.5em}
\setlength{\textfloatsep}{\fill}
\addtolength{\textfloatsep}{3em}
\renewcommand{\textfraction}{0.5}
\renewcommand{\topfraction}{0.5}
\renewcommand{\bottomfraction}{0.5}
\setcounter{totalnumber}{50}
\setcounter{topnumber}{50}
\setcounter{bottomnumber}{50}
% end floats for footnotes
% some commands, that could be overwritten in the style file.
\newcommand{\rubric}[1]{\subsection*{~\hfill {\it #1} \hfill ~}}
\newcommand{\titlereference}[1]{\textsl{#1}}
% end of "some commands"
\ifthenelse{\isundefined{\hypersetup}}{
\usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
}{}
\title{}
\author{}
\date{}
\raggedbottom
\begin{document}

\setlength{\locallinewidth}{\linewidth}

Content block expected for the ``container'' directive; none found.
\begin{quote}{\ttfamily \raggedright \noindent
..~container::~navbar~\\
~\\
~\\
~\\

}\end{quote}



%___________________________________________________________________________

\hypertarget{time}{}
\pdfbookmark[0]{Time}{time}
\section*{Time}
\label{time}

Time waits for no man. Or it flies like an arrow. Something like that. But still keeping accurate time is as important now as it was when Harrison built his first clock.  In a networked world, having one machine with accurate time is not the worst problem - all the machines we use need to be synchronised to the same time, else trying to compare logs on different machines is quite simply a nightmare.

The solution to both these problems is called Network Time Protocol or NTP. NTP is a way for any server to get the current time from an atomic clock, even if it is thousands of miles away.  Atomic clocks keep, what is simply the most accurate time humankind can keep.  These clocks then are used to keep \emph{stratum 1} servers up to date. These stratum 1 servers are the starting point for NTP, and are primarily run by academic and governmental institutions.  They are the source point for, rather boringly, \emph{stratum 2} servers. These stratum 2 servers are run, often by volunteers to provide you and I with a machine that knows precisely what the time is, and more importantly, are willing to tell us.

Whilst the servers themselves are run in wildly different locations, and by different organisations, a sensible DNS round-robin is in  place.
\begin{quote}{\ttfamily \raggedright \noindent
Name:~~~pool.ntp.org~\\
Address:~64.202.112.75~(ntp.your.org.)~\\
~\\
Name:~~~pool.ntp.org~\\
Address:~38.99.80.156~(clock.fihn.net.)
}\end{quote}

Here two servers run by totally different organisations are pulled up when I ask for pool.ntp.org. So all I need to remember is one dns name and my ntp requests will alwasy find a suitable match. This is good news for me, but also very good news for Poul Henning Kemp\raisebox{.5em}[0em]{\scriptsize\hyperlink{id2}{1}}

Anyway, NTP works in a clever and comlicated way, but the Simple IT manager can get by with a good enough explanation, and a reference for more info.
The good enough explanation is that the NTP client asks for a time check and waits for the answer to come back several times. With enough times and a clever algorithm, the latency in the network can be estimated and that latency can be added to the time in the received message to give an accurate time \emph{right now}.
\begin{quote}{\ttfamily \raggedright \noindent
~NTPv4~can~usually~maintain~time~to~within~10~milliseconds~(1/100~s)~over~the~public~Internet,~and~can~achieve~accuracies~of~200~microseconds~(1/5000~s)~or~better~in~local~area~networks~under~ideal~conditions.~\\
~\\
http://en.wikipedia.org/wiki/Network{\_}Time{\_}Protocol
}\end{quote}


%___________________________________________________________________________

\hypertarget{how-to-get-the-time-right-on-your-server}{}
\pdfbookmark[1]{How to get the time right on your server}{how-to-get-the-time-right-on-your-server}
\subsection*{How to get the time right on your server}
\label{how-to-get-the-time-right-on-your-server}
\newcounter{listcnt0}
\begin{list}{\arabic{listcnt0}.}
{
\usecounter{listcnt0}
\setlength{\rightmargin}{\leftmargin}
}
\item {} 
Set your current timezone

\item {} 
set the time correctly from an atomic clock

\item {} 
keep on adjusting it

\end{list}

1. Set your current timezone
In /usr/share/zoneinfo are a series of binary files that represent to the server how to calculate the timezone - so /usr/share/zoneinfo/Europe/London tells us how to adjust for the GMT zone.
We want to copy the one that is right for our location in to /etc/localtime
\begin{quote}

diff /etc/localtime /usr/share/zoneinfo/Europe/London
\end{quote}

(there may not be a /etc/localtime file. In fact if this is the first install, there wont be)

So let us have some fun:
\begin{quote}{\ttfamily \raggedright \noindent
manhattan{\#}~cp~/usr/share/zoneinfo/Asia/Tokyo~~/etc/localtime~\\
manhattan{\#}~adjkerntz~-a~\\
manhattan{\#}~date~\\
Sat~Aug~16~20:16:02~JST~2008~\\
manhattan{\#}~\\
manhattan{\#}~\\
manhattan{\#}~cp~/usr/share/zoneinfo/Europe/London~/etc/localtime~\\
manhattan{\#}~adjkerntz~-a~\\
manhattan{\#}~date~\\
Sat~Aug~16~12:16:23~BST~2008
}\end{quote}


%___________________________________________________________________________

\hypertarget{clock-synchronisation}{}
\pdfbookmark[1]{2. clock synchronisation}{clock-synchronisation}
\subsection*{2. clock synchronisation}
\label{clock-synchronisation}

Ok, we can control what timezone the machine thinks it is in, but how do we get the time correct?
The configuration file for ntp daemon is /etc/ntpd.conf

put this into /etc/ntpd.conf:
\begin{quote}{\ttfamily \raggedright \noindent
driftfile~/var/lib/ntp/ntp.drift~\\
~\\
server~0.pool.ntp.org~\\
server~1.pool.ntp.org~\\
server~2.pool.ntp.org~\\
server~pool.ntp.org
}\end{quote}

(NB there is a diff between the location in freebsd handook and the ntp ssite for conf file
ntpd.conf vs ntp.conf. ntp.conf is right - follow the handbook)

This tells the server to use a drift file, which is how ntpd calculates the average latency for its requests, and
which servers it should contact - if you wanted a really minimalist conf file, the last line will suffice.

Enable the server at boot time:
\begin{quote}{\ttfamily \raggedright \noindent
ntpd{\_}enable="YES"~to~/etc/rc.conf
}\end{quote}

TO force the server to change to a new time, especially if the time is a long way out, then we can use
\begin{quote}

ntpdate pool.ntp.org
\end{quote}

ntpdate forces a time update no matter how far out the server is - this is useful, but you should rely on ntpd to correct the time
- if it finds itself correcting large leaps it will scream to the logs. This is good - there are only two reasons for regular large corrections, either your motherboards clock is dying or you have invented time travel.

Sample rc.conf file with a full time set on boot:
\begin{quote}{\ttfamily \raggedright \noindent
ntpdate{\_}enable="YES"~\\
ntpdate{\_}flags="pool.ntp.org"~\\
{\#}enable~ntpd~after~ntpdate~-~ntpdate~does~nothing~if~~ntpd~is~running.~\\
ntpd{\_}enable="YES"
}\end{quote}


%___________________________________________________________________________

\hypertarget{notes}{}
\pdfbookmark[0]{Notes}{notes}
\section*{Notes}
\label{notes}
\begin{figure}[b]\hypertarget{id2}$^{1}$
Poul-Henning Kemp is a respected FreeBSD developer who ran a Stratum 1 Server. His server was referenced by a commercial domestic router sold in its millions, and by IP address. He was getting 3 million packets a day extra.
\end{figure}

Explicit markup ends without a blank line; unexpected unindent.


Fuller story is at \href{http://www.lightbluetouchpaper.org/2006/04/07/when-firmware-attacks-ddos-by-d-link/}{http://www.lightbluetouchpaper.org/2006/04/07/when-firmware-attacks-ddos-by-d-link/}


%___________________________________________________________________________

\hypertarget{bibliography}{}
\pdfbookmark[1]{Bibliography}{bibliography}
\subsection*{Bibliography}
\label{bibliography}

\href{http://www.freebsd.org/doc/en/books/handbook/network-ntp.html}{http://www.freebsd.org/doc/en/books/handbook/network-ntp.html}
\href{http://support.ntp.org/bin/view/Servers/NTPPoolServers}{http://support.ntp.org/bin/view/Servers/NTPPoolServers}

\end{document}
