<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title></title>
  
  <link rel="stylesheet" href="/root/foo/css/cookbook.css" type="text/css" />


</head>

<body>

<div id="header">

<img src="/root/foo/img/tour_tonbridge.jpg" 
         style="width:100%; position:relative; top:-10px;"
         alt="itmanagerscookbook.com"
         title="IT Manager's CookBook"
         />

   <ul style="width:50%;">
     <li><a href="/root/foo/Introduction/WhatsGoingOnHere.html">What's all this?</a></li>
     <li><a href="/root/foo/Introduction/introduction.html">Introduction</a></li>
     <li><a href="/root/foo/index.html">Contents</a></li>

   </ul>
</div>

<div class="colmask rightmenu">
    <div class="colleft">
        <div class="col1wrap">
            <div class="col1">
                <!-- Column 1 start -->
<div class="section" id="time">
<h2>Time</h2>
<p>Time waits for no man. Or it flies like an arrow. Something like that. But still keeping accurate time is as important now as it was when Harrison built his first clock.  In a networked world, having one machine with accurate time is not the worst problem - all the machines we use need to be synchronised to the same time, else trying to compare logs on different machines is quite simply a nightmare.</p>
<p>The solution to both these problems is called Network Time Protocol or NTP. NTP is a way for any server to get the current time from an atomic clock, even if it is thousands of miles away.  Atomic clocks keep, what is simply the most accurate time humankind can keep.  These clocks then are used to keep <em>stratum 1</em> servers up to date. These stratum 1 servers are the starting point for NTP, and are primarily run by academic and governmental institutions.  They are the source point for, rather boringly, <em>stratum 2</em> servers. These stratum 2 servers are run, often by volunteers to provide you and I with a machine that knows precisely what the time is, and more importantly, are willing to tell us.</p>
<p>Whilst the servers themselves are run in wildly different locations, and by different organisations, a sensible DNS round-robin is in  place.</p>
<pre class="literal-block">
Name:   pool.ntp.org
Address: 64.202.112.75 (ntp.your.org.)

Name:   pool.ntp.org
Address: 38.99.80.156 (clock.fihn.net.)
</pre>
<p>Here two servers run by totally different organisations are pulled up when I ask for pool.ntp.org. So all I need to remember is one dns name and my ntp requests will alwasy find a suitable match. This is good news for me, but also very good news for Poul Henning Kemp <a class="footnote-reference" href="#id2" id="id1">[1]</a></p>
<p>Anyway, NTP works in a clever and comlicated way, but the Simple IT manager can get by with a good enough explanation, and a reference for more info.
The good enough explanation is that the NTP client asks for a time check and waits for the answer to come back several times. With enough times and a clever algorithm, the latency in the network can be estimated and that latency can be added to the time in the received message to give an accurate time <em>right now</em>.</p>
<pre class="literal-block">
 NTPv4 can usually maintain time to within 10 milliseconds (1/100 s) over the public Internet, and can achieve accuracies of 200 microseconds (1/5000 s) or better in local area networks under ideal conditions.

http://en.wikipedia.org/wiki/Network_Time_Protocol
</pre>
<div class="section" id="how-to-get-the-time-right-on-your-server">
<h3>How to get the time right on your server</h3>
<ol class="arabic simple">
<li>Set your current timezone</li>
<li>set the time correctly from an atomic clock</li>
<li>keep on adjusting it</li>
</ol>
<p>1. Set your current timezone
In /usr/share/zoneinfo are a series of binary files that represent to the server how to calculate the timezone - so /usr/share/zoneinfo/Europe/London tells us how to adjust for the GMT zone.
We want to copy the one that is right for our location in to /etc/localtime</p>
<blockquote>
diff /etc/localtime /usr/share/zoneinfo/Europe/London</blockquote>
<p>(there may not be a /etc/localtime file. In fact if this is the first install, there wont be)</p>
<p>So let us have some fun:</p>
<pre class="literal-block">
manhattan# cp /usr/share/zoneinfo/Asia/Tokyo  /etc/localtime
manhattan# adjkerntz -a
manhattan# date
Sat Aug 16 20:16:02 JST 2008
manhattan#
manhattan#
manhattan# cp /usr/share/zoneinfo/Europe/London /etc/localtime
manhattan# adjkerntz -a
manhattan# date
Sat Aug 16 12:16:23 BST 2008
</pre>
</div>
<div class="section" id="clock-synchronisation">
<h3>2. clock synchronisation</h3>
<p>Ok, we can control what timezone the machine thinks it is in, but how do we get the time correct?
The configuration file for ntp daemon is /etc/ntpd.conf</p>
<p>put this into /etc/ntpd.conf:</p>
<pre class="literal-block">
driftfile /var/lib/ntp/ntp.drift

server 0.pool.ntp.org
server 1.pool.ntp.org
server 2.pool.ntp.org
server pool.ntp.org
</pre>
<p>(NB there is a diff between the location in freebsd handook and the ntp ssite for conf file
ntpd.conf vs ntp.conf. ntp.conf is right - follow the handbook)</p>
<p>This tells the server to use a drift file, which is how ntpd calculates the average latency for its requests, and
which servers it should contact - if you wanted a really minimalist conf file, the last line will suffice.</p>
<p>Enable the server at boot time:</p>
<pre class="literal-block">
ntpd_enable=&quot;YES&quot; to /etc/rc.conf
</pre>
<p>TO force the server to change to a new time, especially if the time is a long way out, then we can use</p>
<blockquote>
ntpdate pool.ntp.org</blockquote>
<p>ntpdate forces a time update no matter how far out the server is - this is useful, but you should rely on ntpd to correct the time
- if it finds itself correcting large leaps it will scream to the logs. This is good - there are only two reasons for regular large corrections, either your motherboards clock is dying or you have invented time travel.</p>
<p>Sample rc.conf file with a full time set on boot:</p>
<pre class="literal-block">
ntpdate_enable=&quot;YES&quot;
ntpdate_flags=&quot;pool.ntp.org&quot;
#enable ntpd after ntpdate - ntpdate does nothing if  ntpd is running.
ntpd_enable=&quot;YES&quot;
</pre>
</div>
</div>
<div class="section" id="notes">
<h2>Notes</h2>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Poul-Henning Kemp is a respected FreeBSD developer who ran a Stratum 1 Server. His server was referenced by a commercial domestic router sold in its millions, and by IP address. He was getting 3 million packets a day extra.</td></tr>
</tbody>
</table>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 103)</p>
Explicit markup ends without a blank line; unexpected unindent.</div>
<p>Fuller story is at <a class="reference external" href="http://www.lightbluetouchpaper.org/2006/04/07/when-firmware-attacks-ddos-by-d-link/">http://www.lightbluetouchpaper.org/2006/04/07/when-firmware-attacks-ddos-by-d-link/</a></p>
<div class="section" id="bibliography">
<h3>Bibliography</h3>
<p><a class="reference external" href="http://www.freebsd.org/doc/en/books/handbook/network-ntp.html">http://www.freebsd.org/doc/en/books/handbook/network-ntp.html</a>
<a class="reference external" href="http://support.ntp.org/bin/view/Servers/NTPPoolServers">http://support.ntp.org/bin/view/Servers/NTPPoolServers</a></p>
</div>
</div>

				<!-- Column 1 end -->
            </div>
        </div>
        <div class="col2">
            <!-- Column 2 start -->
Hello. Do come in. Please take a seat and have a look around.
My name is Paul Brian and this is my online home.
Some <a href="">more about me</a>

<h2>IT matters</h2>
It is a cliche but, computing is going to change the world. And it will take skilled and determined people at the highest reaches of companies and institutions to make that change create better, more human and more interesting places to live and work.  I call those people <em>IT Managers</em>.   

<h2>SoHo From Scratch</h2>
<em>Every</em> IT manager <em>should</em> be able to build and run a complete Small Office or Home Office Network, in the same way every chef should be able to prepare a 3 course meal.  The fact that many people called IT managers cannot is one of the reasons I have written this site.  This area is the more traditional "how to" - a collection of recipies if you will.


<h2>Beyond Recipies</h2>
Not everything is about configuring systems. Most of the job is configuring people, and the <em>trade secrets</em> of IT management.  I give my opinions on everything from project management to out-greening the competition. The youngsters round 'ere think I am a dinosaur.  


<h2>Other Points of View</h2>
A collection of interviews and commentaries from other IT Managers, trying to capture the essence of this craft, and hopefully a funny story or two.





			<!-- Column 2 end -->

        </div>
    </div>
</div>

<div id="footer">
    The IT Managers CookBook

</div>

<!-- google analytics -->

</body>
</html>
